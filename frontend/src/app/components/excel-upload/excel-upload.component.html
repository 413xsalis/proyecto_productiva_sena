<div class="excel-upload-container">
  <!-- Header igual al Dashboard -->
  <header class="upload-header">
    <div class="header-content">
      <div class="brand">
        <div class="logo">üìä</div>
        <h1>Gesti√≥n de Archivos Excel</h1>
      </div>
      
      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar">
            {{ getUserInitials() }}
          </div>
          <div class="user-details">
            <span class="user-name">{{ userName }}</span>
            <span class="user-email">{{ userEmail }}</span>
          </div>
        </div>
        <button class="back-btn" (click)="navigateToDashboard()">
          <span>‚Üê</span>
          Volver al Dashboard
        </button>
      </div>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="upload-main">
    <!-- Secci√≥n de bienvenida -->
    <div class="welcome-section">
      <div class="welcome-card">
        <h2>Gesti√≥n de Archivos Excel üìà</h2>
        <p>Sube, procesa y administra tus archivos Excel de forma eficiente. Soporta formatos .xls y .xlsx.</p>
      </div>
    </div>

    <!-- Mensajes de estado -->
    <div *ngIf="message" class="alert" [class.alert-success]="messageType === 'success'" [class.alert-error]="messageType === 'error'">
      {{ message }}
    </div>

    <!-- Tarjeta de subida -->
    <div class="upload-card">
      <div class="card-header">
        <h3>Subir Nuevo Archivo</h3>
        <p>Arrastra o selecciona tu archivo Excel para comenzar</p>
      </div>

      <div 
        class="upload-area" 
        [class.dragging]="isDragging"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
      >
        <div class="upload-content">
          <div class="upload-icon">üìÅ</div>
          <h4>Arrastra tu archivo aqu√≠</h4>
          <p>Formatos soportados: .xls, .xlsx (M√°ximo 10MB)</p>
          
          <label for="fileInput" class="browse-btn">
            <span>Seleccionar archivo</span>
            <input 
              type="file" 
              id="fileInput" 
              (change)="onFileSelected($event)"
              accept=".xls,.xlsx" 
              hidden
            >
          </label>
        </div>
      </div>

      <!-- Archivo seleccionado -->
      <div *ngIf="selectedFile" class="selected-file">
        <div class="file-info">
          <span class="file-icon">üìÑ</span>
          <div class="file-details">
            <strong>{{ selectedFile.name }}</strong>
            <span>{{ formatFileSize(selectedFile.size) }}</span>
          </div>
          <button class="remove-btn" (click)="removeFile()">‚úï</button>
        </div>
        
        <button 
          class="upload-btn" 
          (click)="onSubmit()" 
          [disabled]="isLoading"
        >
          <span *ngIf="!isLoading">Subir Archivo</span>
          <span *ngIf="isLoading" class="loading">
            <div class="spinner"></div>
            Subiendo...
          </span>
        </button>
      </div>
    </div>

    <!-- Lista de archivos -->
    <div class="files-section" *ngIf="userFiles.length > 0">
      <div class="section-header">
        <h3>Tus Archivos</h3>
        <span class="file-count">{{ userFiles.length }} archivos</span>
      </div>

      <div class="files-grid">
        <div *ngFor="let file of userFiles" class="file-card">
          <div class="file-card-header">
            <div class="file-info-compact">
              <div class="file-icon-small">üìä</div>
              <div class="file-main-info">
                <h4>{{ file.original_name }}</h4>
                <div class="file-meta">
                  <span class="file-size">{{ formatFileSize(file.file_size) }}</span>
                  <span class="file-date">{{ file.upload_date | date:'dd/MM/yyyy HH:mm' }}</span>
                  <span class="file-uploader">Subido por: {{ file.uploaded_by }}</span>
                </div>
              </div>
            </div>
            <span class="file-status" [class]="file.status">
              {{ file.status === 'pending' ? 'Pendiente' : 
                 file.status === 'processed' ? 'Procesado' : 'Error' }}
            </span>
          </div>

          <!-- Barra de progreso -->
          <div *ngIf="processingFileId === file.id" class="processing-progress">
            <div class="progress-header">
              <span>Procesando archivo...</span>
              <span class="progress-percent">{{ processingProgress }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="processingProgress"></div>
            </div>
          </div>

          <div class="file-actions">
            <div class="action-group">
              <button 
                *ngIf="file.status === 'pending'" 
                class="process-btn"
                (click)="processFile(file.id)"
                [disabled]="isProcessing"
              >
                Procesar
              </button>
              
              <div *ngIf="file.status === 'processed'" class="success-badge">
                ‚úÖ Listo
              </div>
            </div>

            <div class="action-buttons">
              <button 
                class="icon-btn"
                (click)="downloadFile(file.id, file.original_name)"
                [disabled]="isDeleting"
                title="Descargar archivo"
              >
                üì•
              </button>
              
              <button 
                class="icon-btn danger"
                (click)="deleteFile(file.id, file.original_name)"
                [disabled]="isDeleting"
                title="Eliminar archivo"
              >
                <span *ngIf="!isDeleting">üóëÔ∏è</span>
                <span *ngIf="isDeleting" class="loading">
                  <div class="spinner-small"></div>
                </span>
              </button>
            </div>
          </div>

          <!-- Vista previa de datos -->
          <div *ngIf="file.status === 'processed' && file.processed_data" class="data-preview">
            <div class="preview-header">
              <h5>Vista Previa</h5>
              <span class="preview-count">{{ file.processed_data.length }} filas</span>
            </div>
            <div class="preview-table">
              <table>
                <thead>
                  <tr>
                    <th *ngFor="let key of getDataKeys(file.processed_data)">{{ key }}</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let row of file.processed_data.slice(0, 3)">
                    <td *ngFor="let key of getDataKeys(file.processed_data)">
                      {{ row[key] }}
                    </td>
                  </tr>
                </tbody>
              </table>
              <div *ngIf="file.processed_data.length > 3" class="preview-more">
                ... y {{ file.processed_data.length - 3 }} filas m√°s
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vac√≠o -->
    <div *ngIf="userFiles.length === 0 && !selectedFile" class="empty-state">
      <div class="empty-icon">üìä</div>
      <h4>No hay archivos subidos</h4>
      <p>Sube tu primer archivo Excel para comenzar</p>
    </div>
  </main>
</div>